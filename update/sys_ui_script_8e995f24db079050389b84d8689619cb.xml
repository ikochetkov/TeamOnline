<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_ui_script">
    <sys_ui_script action="INSERT_OR_UPDATE">
        <active>true</active>
        <description/>
        <global>false</global>
        <name>x_aaro2_teamonline.compress.js</name>
        <script><![CDATA[!function(e,t){if("function"==typeof define&&define.amd)define(["module","./core/base64.js","./core/converter.js","./core/file.js","./core/image.js","./core/photo.js","./core/rotate.js"],t);else if("undefined"!=typeof exports)t(module,require("./core/base64.js"),require("./core/converter.js"),require("./core/file.js"),require("./core/image.js"),require("./core/photo.js"),require("./core/rotate.js"));else{var n={exports:{}};t(n,e.base64,e.converter,e.file,e.image,e.photo,e.rotate),e.compress=n.exports}}(this,function(e,t,n,r,i,a,o){"use strict";var u=h(t),s=h(n),f=h(r),l=h(i),c=h(a),d=h(o);function h(e){return e&&e.__esModule?e:{default:e}}var v=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),g=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return v(e,[{key:"attach",value:function(e,t){var n=this;return new Promise(function(r,i){var a=document.querySelector(e);a.setAttribute("accept","image/*"),a.addEventListener("change",function(e){var i=n.compress([].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(e.target.files)),t);r(i)},!1)})}},{key:"compress",value:function(e,t){function n(e,t){var n=new c.default(t);n.start=window.performance.now(),n.alt=e.name,n.ext=e.type,n.startSize=e.size,Promise.resolve().then(d.default.orientation(e)).then(function(t){return console.log("orientation=",t),n.orientation=t,f.default.load(e)}).then(function(e){return function(t){return l.default.load(t).then(function(t){if(e.startWidth=t.naturalWidth,e.startHeight=t.naturalHeight,e.resize){var n=l.default.resize(e.maxWidth,e.maxHeight)(t.naturalWidth,t.naturalHeight),r=n.width,i=n.height;e.endWidth=r,e.endHeight=i}else e.endWidth=t.naturalWidth,e.endHeight=t.naturalHeight;return s.default.imageToCanvas(e.endWidth,e.endHeight,e.orientation)(t)}).then(function(t){return e.iterations=1,e.base64prefix=u.default.prefix(e.ext),function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;var i=arguments[3];var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;var o=arguments[5];var f=s.default.canvasToBase64(t,r);var l=u.default.size(f);o+=1;if(l>i)return e(t,l,r-.1,i,a,o);if(r>a)return e(t,l,r-.1,i,a,o);if(r<.5)return f;return f}(t,e.startSize,e.quality,e.size,e.minQuality,e.iterations)}).then(function(t){return e.finalSize=u.default.size(t),u.default.data(t)}).then(function(t){e.end=window.performance.now();var n=e.end-e.start;return{data:t,prefix:e.base64prefix,elapsedTimeInSeconds:n/1e3,alt:e.alt,initialSizeInMb:s.default.size(e.startSize).MB,endSizeInMb:s.default.size(e.finalSize).MB,ext:e.ext,quality:e.quality,endWidthInPx:e.endWidth,endHeightInPx:e.endHeight,initialWidthInPx:e.startWidth,initialHeightInPx:e.startHeight,sizeReducedInPercent:(e.startSize-e.finalSize)/e.startSize*100,iterations:e.iterations}})}}(n))}return Promise.all(e.map(function(e){return n(e,t)}))}}],[{key:"convertBase64ToFile",value:function(e,t){return s.default.base64ToFile(e,t)}}]),e}();e.exports=g});]]></script>
        <script_name>compress.js</script_name>
        <sys_class_name>sys_ui_script</sys_class_name>
        <sys_created_by>andrey.mironyuk</sys_created_by>
        <sys_created_on>2020-09-01 15:26:06</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>8e995f24db079050389b84d8689619cb</sys_id>
        <sys_mod_count>5</sys_mod_count>
        <sys_name>x_aaro2_teamonline.compress.js</sys_name>
        <sys_package display_value="TEAMonline" source="x_aaro2_teamonline">a2dfc25fdb7244105f65ba03e29619fa</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="TEAMonline">a2dfc25fdb7244105f65ba03e29619fa</sys_scope>
        <sys_update_name>sys_ui_script_8e995f24db079050389b84d8689619cb</sys_update_name>
        <sys_updated_by>andrey.mironyuk</sys_updated_by>
        <sys_updated_on>2020-09-01 15:56:25</sys_updated_on>
        <ui_type>0</ui_type>
        <use_scoped_format>false</use_scoped_format>
    </sys_ui_script>
</record_update>
